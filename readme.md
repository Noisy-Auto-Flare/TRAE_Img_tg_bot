# ImgBot

Телеграм-бот, который:
- принимает присланные ему фотографии;
- публикует их в указанном канале (поддерживаются приватные каналы с numeric ID);
+- присваивает каждой фото уникальный номер;
- по номеру отправляет фото обратно пользователю.

## Требования
- Python 3.10+
- Токен бота от BotFather
- Доступ к каналу, куда бот будет публиковать изображения (бот должен быть администратором)

## Установка
1. Склонируйте проект и перейдите в каталог:
   ```bash
   cd ImgBot
   ```
2. Создайте виртуальное окружение и установите зависимости:
   ```bash
   python3 -m venv .venv
   .venv/bin/pip install -r requirements.txt
   ```

## Настройка
1. Создайте файл `.env` на основе `.env.example`:
   ```bash
   cp .env.example .env
   ```
2. Заполните переменные:
   - `TELEGRAM_TOKEN` — токен вашего бота.
   - `CHANNEL_ID` — идентификатор канала:
     - для публичного канала можно указать `@username`;
     - для приватного канала необходимо указать **numeric ID**, обычно вида `-100xxxxxxxxxx`.
   - `DB_PATH` — путь к базе SQLite (по умолчанию `./imgbot.sqlite`).

3. Добавьте бота в канал и назначьте администратором с правом публикации сообщений.

## Как узнать ID приватного канала
Приватный канал не имеет `@username`, поэтому нужен numeric ID:
- Самый простой способ — временно сделать канал публичным, задать `@username`, затем получить ID через любые инструменты (например, боты для получения ID), после чего можно вернуть канал в приватный. ID останется прежним.
- Альтернативно можно использовать сторонние инструменты/боты для получения chat id, переслав им сообщение из канала. Искомый ID, как правило, начинается с `-100`.

После получения ID укажите его в `.env`:
```
CHANNEL_ID=-1001234567890
```

## Запуск
```bash
.venv/bin/python -m src.app
```
При первом запуске создастся база SQLite. Бот начнёт принимать фотографии и отвечать на запросы.

## Использование
- Отправьте боту фотографию — она будет опубликована в канале с подписью `#<номер>`, а бот ответит “Сохранено как №<номер>”.
- Чтобы получить фото по номеру, отправьте `/get <номер>` или просто число (например, `42`).

## Частые ошибки
- `TELEGRAM_TOKEN не задан` — заполните `.env`.
- `CHANNEL_ID не задан` — заполните `.env`.
- Бот не публикует в канал — проверьте, что он добавлен и имеет права администратора. Для приватного канала используйте numeric ID (обычно `-100...`).

## Структура
- `.env.example` — пример переменных окружения
- `requirements.txt` — зависимости
- `src/config.py` — загрузка и парсинг конфигурации, поддержка приватного канала (numeric ID)
- `src/db.py` — слой работы с SQLite
- `src/app.py` — основной код бота и обработчики

